using Galaxy.API;
using Galaxy.Settings;
using MelonLoader;
using System;
using System.Collections;
using System.Diagnostics;
using UnityEngine;
namespace Galaxy.Exploits
{
    internal class rejoin
    {
        public static void Restart()
        {
            nconfig.CurentWorld = RoomManager.field_Internal_Static_ApiWorldInstance_0.id;
            nconfig.Shouldrejoin = true;
            nconfig.saveconfig($"{MelonUtils.GameDirectory}\\Galaxy\\Config\\GenConfig.json");
            string arguments = "";
            foreach (string stringi in Environment.GetCommandLineArgs())
            {
                arguments += $"{stringi} ";
            }
            System.Diagnostics.Process vrc = new System.Diagnostics.Process();
            vrc.StartInfo.FileName = $"{MelonUtils.GameDirectory}\\VRChat.exe";
            vrc.StartInfo.Arguments = arguments;
            vrc.Start();
            Process.GetCurrentProcess().Kill();

        }


        public static IEnumerator RejoinWorld()
        {
            yield return new WaitForSeconds(2f);
            LogHandler.Log("Join", $"rejoining world {nconfig.CurentWorld}");
            nconfig.Shouldrejoin = false;
            VRC.SDKBase.Networking.GoToRoom(nconfig.CurentWorld);
            nconfig.CurentWorld = null;
            nconfig.saveconfig($"{MelonUtils.GameDirectory}\\Galaxy\\Config\\GenConfig.json");

        }




    }
}
